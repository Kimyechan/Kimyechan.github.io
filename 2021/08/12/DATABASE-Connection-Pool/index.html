
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Run PSVM">
    <title>DATABASE-Connection Pool - Run PSVM</title>
    <meta name="author" content="Yechan Kim">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yechan Kim","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"articleBody":"\n목차\nConnection Pool에 대한 개념과 기본적인 원리\nCommons DBCP로 Connection Pool 이해하기\n\n\n\nConnection Pool이란?\n클라이언트의 요청에 따라 각 어플리케이션의 스레드에서 데이터베이스에 접근하기 위해서는 Connection이 필요하다\nConnection pool은 이런 Connection을 여러 개 생성해 두어 저장해 놓은 공간, 또는 이 공간의 Connection을 필요할 때 꺼내 쓰고 반환하는 기법을 만한다\n\n\n\nDB에 접근하는 단계\n웹 컨테이너가 실행되면서 DB에 연결된 Connection 객체들을 미리 생성하여 pool에 저장한다\nDB에 요청 시, pool에서 Connection 객체를 가져와 DB에 접근한다\n처리가 끝나면 다시 \n\n\n\nConnection이 부족하면?\n모든 요청이 DB에 접근하고 있고 남은 Connection이 없다면, 해당 클라이언트를 대기 상태로 전환시키고 Pool에 Connection이 반환되면 대기 상태에 있는 클라이언트에게 순차적으로 제공된다\n\n왜 사용할까?\n매 연결마다 Connection 객체를 생성하고 소멸시키는 비용을 줄일 수 있다\n미리 생성된 Connection 객체를 사용하기 때문에, DB 접근 시간이 단축된다\nDB에 접근하는 Connection 수를 제한하여, 메모리와 DB에 걸리는 부하를 조정할 수 있다\n\nCommons DBCP로 Connection Pool 이해하기Commons DBCP 속성 설정\nCommons DBCP의 속성은 BasicDataSource 클래스의 setter 메서드로 설정할 수 있다\n\nSpring 프레임 워크를 사용한다면 다음과 같이 bean 설정으로 속성을 등록한다\n  12345678910&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;      destroy-method=&quot;close&quot;    p:driverClassName=&quot;$&#123;db.driverClassName &#125;&quot;    p:url=&quot;$&#123;db.url&#125;&quot;    p:username=&quot;$&#123;db.username&#125;&quot;    p:password=&quot;$&#123;db.password&#125;&quot;    p:maxActive=&quot;$&#123;db.maxActive&#125;&quot;    p:maxIdle=&quot;$&#123;db.maxIdle&#125;&quot;    p:maxWait=&quot;$&#123;db.maxWait&#125;&quot;/&gt;\n\n\n\n커넥션의 개수커넥션 풀의 저장 구조\n커넥션 생성은 Commons DBCP에서 이루어진다\nCommons DBCP는 PoolableConnection 타입의 커넥션을 생성하고 생성한 커넥션에 ConnectionEventListener를 등록한다\nConnectionEventListener에는 애플리케이션이 사용한 커넥션을 풀로 반환하기 위해 JDBC 트라이버가 호출할 수 있는 콜백 메서드가 있다\n생선된 커넥션은 commons-pool의 addObject() 메서드로 커넥션 풀에 추가된다\ncommons-pool은 내부적으로 현재 시간을 담고 있는 타임 스탬프와 추가된 커넥션의 레퍼런스를 한 쌍으로하는 ObjectTimestampPari라는 자료구조를생헝한다\n이들을 LIFO(last in first out) 형태의 CursorableLinkedList로 관리한다\n\n\n\n커넥션 개수 관련 속성\n\n\n속성 이름\n설명\n\n\n\ninitialSize\nBasicDataSource 클래스 생성 후 최초로 getConnection() 메서드를 호출할 때 커넥션 풀에 채워 넣을 커넥션 수\n\n\nmaxActive\n동시에 사용할 수 있는 최대 커넥션 개수 (기본값: 8)\n\n\nmaxIdle\n커넥션 풀에 반납할 때 최대로 유지될 수 있는 커넥션 개수 (기본값: 8)\n\n\nminIdle\n최소한으로 유지할 커넥션 개수 (기본값: 0)\n\n\n\n8개의 커넥션을 최대로 활용할 수 있고 4개는 사용중이고 4개는 대기 중인 상태\n  \n\n커넥션 개수와 관련된 가장 중요한 성능 요소는 일반적을 커넥션의 최대 개수이다\n\nmaxActive 값은 DBMS의 설정과 애플리케이션 서버의 개수, Apache, Tomcat에서 동시에 처리할 수 있는 사용자 수 등을 고려해서 설정해야 한다.\n\nDBMS가 수용할 수 잇는 커넥션 개수를 확인한 후에 어플리케이션 서버 인스턴스 1개가 사용하기에 적절한 개수를 설정한다\n\n사용자가 몰려서 커넥션을 많이 사용할 때는 maxActive 값이 충분히 크지 않다면 병목 지점이 될 수 있다\n\n반대로 사용자가 적어서 사용자가 적어서 상요 중인 커넥션이 많지 않은 시스템에서는 maxActive 값을 지나치게 작게 설정하지 않는 한 성능에 영향이 없다\n\n\n커넥션을 얻기 전 대기 시간\nBasicDataSource 클래스의 maxWait 속성은 커넥션 풀 안의 커넥션이 고갈됐을 때 커넥션 반납을 대기하는 시간이며 기본값은 무한정이다\n사용자가 갑자기 급증하거나 DBMS에 장애가 발생했을 때 장애를 더욱 크게 확산시킬 수 있어 주의해야 한다.\n적절한 maxWait 값을 설정하려면 TPS(transaction per seconds)와 Tomcat에서 처리 가능한 스레드 개수 등을 이해해야 한다\n\nTPS(transaction per seconds)\nmaxActive = 5과 maxIdle = 5, minIdle = 5로 설정한 상황을 가정한다\n요청 하나당 쿼리 10개를 실행한다고 가정한다\n각 쿼리의 평균 실행 시간은 50밀리초라고 하면 전체 10개 쿼리의 실행 시간은 500밀리초 이다.\n요청에 대한 초종 응답 시간은 500밀리초라고 생각할 수 있다.\n\n\n\n\n커넥션 풀에 이용 가능한 유휴 상태의 커넥션이 5개일 때는 동시에 5개의 요청을 500밀리초 동안 처리한다\n따라서 1초 동안에는 10개의 요청을 처리할 수 있고 성능 지수는 10TPS라고 볼 수 있다\n\n\n\nTPS와 커넥션 개수와의 관계\n처리할 요청 수가 증가해도 커넥션 풀의 커넥션 개수가 5개이면 10TPS 이상의 성능을 낼 수 없다\n1번부터 5번까지 요청이 실행되는 동안은 커넥션 풀에 여분의 커넥션이 없다\n6번부터 10번까지 요청은 대기(wait)상태가 되 여분의 커넥션이 생길 때까지 maxWait 값만큼 기다린다\n\n\n\n\n이를 해결하는 가장 수운 방법은 maxActive 값을 높여서 커넥션 풀의 개수를 늘리는 것이다\n\n\n\n\n커넥션의 개수를 5에서 10으로 늘리면 전체적인 성능도 10TPS로 증가한다\n하지만 일반적을 DBMS의 리소스는 다른 서비스와 공유해 사용하는 경우가 많기 때문에 무조건 커넥션 개수를 크게 설정할 수 없다\n따라서 예상 접속자 수와 서비스의 실제 부하를 측정해 최적의 값을 설정하는 것이 중요하다\n대기 시간 (wait) 값 조절이 커넥션의 개수를 무한히 늘리지 않고 최적의 시스템을 환겨을 구축하는데 중요한 역할을 한다\nmaxWait 값을 어떻게 설정했는지가 일시적인 과부하 상태에서 드러나는 시스템의 전체적인 견고함을 결정짓는다\n\n\n\n\n적당한 maxWait 값은 Commons DBCP 외에 Tomcat의 동작 방식도 고려해야 한다\nTomcat은 스레드 기반으로 동작해 사용자의 요청을 처리한다\nTomcateh 내부에 스레드 풀을 가지고 잇어서 사용자의 요청이 들어올 때마다 스레드 풀에서 하나씩 스레드를 꺼내 요청을 처리한다\n1 ~ 5번의 요청이 처리되기 전에 또 다른 요청이 들어온다\n즉 동시에 6개의 요청이 들어왔을 때 6번 요청은 여분의 커넥션이 없으므로 maxWait 값 만큼 기다린다 (Tomcat의 스레드가 기다리는 주체이다)\n\n적절한 maxWait 값은?\n위의 그림에서 maxWait 속성에 설정한 시간이 10,000 밀리초이면 처리량을 넘어서는 요청의 스레드는 10초 동안 대기 상태에 있게 된다\n그리고 사용자의 요청이 계속 증가하면 결국 Tomcat 스레드 풀의 모든 스레드가 소진돼 Tomcat은 아래와 같은 오류를 출력하며 응답을 멈출 것이다  1심각: All threads (512) are currently busy, waiting. Increase maxThreads (512) or check the servlet status\n10초 동안의 대기 상태가 해제되고 커넥션을 획득해 사용자의 요청을 열심히 처리하고 응답을 보내도 그 응답을 받을 사용자는 이미 떠나고 난 뒤인 경우도 있다\n이럴 경우 사용자가 인내할 수 있는 시간을 넘어서는 maxWait 값은 아무런 의미가 없다\n반대의 경우에는 커넥션 풀에 여분이 없을 때마다 오류가 반환된다\nmaxWait 값도 사용자의 대기 가능한 시간 같은, 어플리케이션의 특성 및 자원의 상황을 고려해야한다\n만약 갑작스럽게 사용자가 증가해 maxWait 값 안에 커넥션을 얻지 못하는 빈도가 늘어난다면 maxWait을 줄여서 스레드가 한도에 도달하지 않도록 한다\n전체 시스템의 장애는 피하고 ‘간헐적 오류’가 발생하는 정도로 장애의 영향을 줄인다\n이런 상황이 자주 있다면 Commons DBCP의 maxActive 값과 Tomcat의 maxThread 값을 동시에 늘이는 것을 고려한다 \n그러나 시스템 자원의 한도를 넘어선다면 시스템을 확충해야한다\n\n커넥션의 검사와 정리\n유효성 검사 쿼리 (validation query)와 Evictor 스레드 관련 설정으로도 애플리케이션의 안정성을 높일 수 있다\n\n유효성 검사쿼리의 설정\nJDBC 커넥션의 유효성에 대한 validationQuery 옵션\ntestOnBorrow: 커넥션 풀에서 커넥션을 얻어올 때 테스트 실행(기본값: true)\ntestOnReturn: 커넥션 풀로 커넥션을 반환할 때 테스트 실행(기본값: false)\ntestWhileIdle: Evictor 스레드가 실행될 때 (timeBetwwenEvictionRunMills &gt; 0) 커넥션 풀 안에 있는 유휴 상태의 커넥션을 대상으로 테스트 실행 (기본값: false)\n\n\n검증에 지나치게 자원을 소모하지 않게 testOnBorrow와 testOnReturn 옵션을 false로 설정한다\n오랫동안 대기상태였던 커넥션이 끊어지는 현상을 막기위해 testWhileIdle 옵션은 true로 설정한다\n부적절한 상태의 커넥션이 반납되었을 때 testWhileIdle = true이면 커넥션 풀에서 오류가 발생하는 커넥션을 제외할 수 있다\n\nEvictor 스레드와 관련된 속성\nEvictor 스레드는 Commons DBCP 내부에서 커넥션의 자원을 정리하는 구성요소이며 별도의 스레드로 실행된다\n\n관련 속성\n\ntimeBetweenEvictionRunsMills: Evictor 스레드가 동작하는 간격, 기본값은 -1이며 Evictor 스레드의 실행이 비활성화되어있다\nnumTestsPerEvictionRun: Evictor 스레드 동작 시 한 번에 검사할 커넥션 수\nminEvictableIdleTimeMillis: 스레드 동작 시 커넥션의 유휴 시간을 확인해 설정 값 이상일 경우 커넥션을 제거한다 (기본값: 30분)\n\n\n역할\n\n커넥션 풀 내의 유휴 상태의 커넥션 중에서 오랫동안 사용되지 않은 커넥션을 추출해 제거한다\n\nEvictor 스레드 실행 시 설정된 numTestsPerEvictionRun 속서값만큼 CursorableLinkedList의 ObjectTimestampPar을 확인한다\nObjectTimestampPair의 타임 스탬프 값과 현재 시간의 타임 스탬프 값의 차이가 minEvictableIdleTimeMillis 속성을 초과하면 해당 커넥션을 제거한다\n커넥션 숫자를 적극적으로 줄여야한다면 사용하지 않기\n\n\n커넥션에 대해서 추가로 유효성 검사를 수행해 문제가 있을 경우 해당 커넥션을 제거한다\n\ntestWhileIdle = true 일때만 이 동작을 수행한다\n첫 번째 작업 시 minEvictableIdleTimeMillis 속성값을 초과하지 않은 커넥션에 대해서 추가로 유효성 검사를 수행하는 것이다.\n\n\n앞의 두 작업 이후 남아있는 커넥션의 개수가 minIdle 속성값보다 작으면 minIdle 속성값 만큼 커넥션을 생성해 유지한다\ntestWhileIdle=true &amp;&amp; timeBetweenEvictionRunMillis &gt; 0이면 위의 3가지 역할을 다 수행하고, \ntestWhileIdle=false &amp;&amp; timeBetweenEvictionRunMillis &gt; 0이면 두 번째 동작은 수행하지 않는다.\n\n\n\n주의점\n\nEvictor 스레드는 동작 시에 커넥션 풀에 잠금(lock)을 걸고 동작하기 때문에 너무 자주 실행하면 서비스 실행에 부담을 줄 수 있다\nnumTestsPerEvictionRun 값을 너무 크게 설정하면 Evictor 스레드가 검사해야하는 커넥션 수가 많아져 잠금 상태에 있는 시간이 길어지므로 실행에 부담이 된다.\n\n\n유용한 방안\n\nIDC(internet data center) 정책에 따라서는 서버 간의 소켓 연결 후 정해진 시간 이상 아무런 패킷도 주고받지 않으면 연결을 종료한다\ntimeBetweenEvictionRunsMills 속성으로 의도하지 않게 연결이 끊어지는 것을 방어할 수 있다.\nex) 30분 동안 통신이 없을 때 연결이 끊어지는 정책으로 네트워크를 운영한다면, BasicDataSource가 풀링(pooling)하는 커넥션의 수가 30개라고 가정할 때\n30분 안에 모든 커넥션에 유효성 검사 쿼리를 한 번씩은 실행하는 것이 바람직하다.\nEvictor 스레드가 5분에 한 번씩 실행되도록 설정했을 때 30분 동안 Evictor 스레드 실행 횟수는 6번이므로 매번 5개의 커넥션을 검사해야 전체 커넥션을 테스트할 수 있다.\n30분 안에 5분마다 Evctor 스레드가 실행되면 6번 실행되지만 오차를 감안해 5번으로 가정하면 이때 설정해야 할 numTestsPerEvictionRun 값은 다음과 같이 구할 수 있다\n6 * numTestsPerEvictionRun &gt; 30개\n따라서 numTestsPerEvictionRun 속성값은 최소 6 이상이어야 한다. 일반적인 공식으로 정리하면 다음과 같다\n(&#39;IDC 정책에서 허용하는 최대 유휴 커넥션 유지 시간&#39; / timeBetweenEvictionRunsMillis 속성값) * numTestsPerEvictionRun 속성값) &gt; 전체 커넥션 개수\n\n\n\n\n\nreference\nhttps://d2.naver.com/helloworld/5102792\nhttps://github.com/WeareSoft/tech-interview/blob/master/contents/db.md\n\n읽어보면 좋은 것들\n1부 : https://techblog.woowahan.com/2664/\n2부 : https://techblog.woowahan.com/2663/\n\n","dateCreated":"2021-08-12T23:14:02+09:00","dateModified":"2021-08-14T00:33:41+09:00","datePublished":"2021-08-12T23:14:02+09:00","description":"","headline":"DATABASE-Connection Pool","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"},"publisher":{"@type":"Organization","name":"Yechan Kim","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"]},"url":"https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"}</script>
    <meta name="description" content="목차 Connection Pool에 대한 개념과 기본적인 원리 Commons DBCP로 Connection Pool 이해하기    Connection Pool이란? 클라이언트의 요청에 따라 각 어플리케이션의 스레드에서 데이터베이스에 접근하기 위해서는 Connection이 필요하다 Connection pool은 이런 Connection을 여러 개 생성해 두">
<meta property="og:type" content="blog">
<meta property="og:title" content="DATABASE-Connection Pool">
<meta property="og:url" content="https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/index.html">
<meta property="og:site_name" content="Run PSVM">
<meta property="og:description" content="목차 Connection Pool에 대한 개념과 기본적인 원리 Commons DBCP로 Connection Pool 이해하기    Connection Pool이란? 클라이언트의 요청에 따라 각 어플리케이션의 스레드에서 데이터베이스에 접근하기 위해서는 Connection이 필요하다 Connection pool은 이런 Connection을 여러 개 생성해 두">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129360250-cd019646-65de-4de3-a7f8-3853f3401a17.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129360264-3d2fa805-766d-49b2-a239-1b62a70abf58.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129361133-06879c87-e511-4d7a-b48a-ff34e992c27c.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129369423-0d9c868f-4d87-479a-a079-30df962c06d1.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129373713-47b6a934-5508-4f9d-abca-0221f34ec548.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129374488-f3e9bbc8-6ac1-403f-aba2-4752c0bc8f31.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129374493-f499dc43-efa9-4fef-98fb-ccf4e9693294.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129374496-1dea2379-57b1-450d-a4df-90595822e7dd.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/12459864/129375608-11845037-adc0-40e0-8324-6f999ed25818.png">
<meta property="article:published_time" content="2021-08-12T14:14:02.000Z">
<meta property="article:modified_time" content="2021-08-13T15:33:41.073Z">
<meta property="article:author" content="Yechan Kim">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-images.githubusercontent.com/12459864/129360250-cd019646-65de-4de3-a7f8-3853f3401a17.png">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Run PSVM
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://plus.google.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google +"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            DATABASE-Connection Pool
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-08-12T23:14:02+09:00">
	
		    Aug 12, 2021
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <ul>
<li>목차<ul>
<li>Connection Pool에 대한 개념과 기본적인 원리</li>
<li>Commons DBCP로 Connection Pool 이해하기</li>
</ul>
</li>
</ul>
<h2 id="Connection-Pool이란"><a href="#Connection-Pool이란" class="headerlink" title="Connection Pool이란?"></a>Connection Pool이란?</h2><ul>
<li>클라이언트의 요청에 따라 각 어플리케이션의 스레드에서 데이터베이스에 접근하기 위해서는 Connection이 필요하다</li>
<li>Connection pool은 이런 Connection을 여러 개 생성해 두어 저장해 놓은 공간, 또는 이 공간의 Connection을 필요할 때 꺼내 쓰고 반환하는 기법을 만한다</li>
</ul>
<img width="500" alt="스크린샷 2021-08-13 오후 9 44 34" src="https://user-images.githubusercontent.com/12459864/129360250-cd019646-65de-4de3-a7f8-3853f3401a17.png">

<h3 id="DB에-접근하는-단계"><a href="#DB에-접근하는-단계" class="headerlink" title="DB에 접근하는 단계"></a>DB에 접근하는 단계</h3><ol>
<li>웹 컨테이너가 실행되면서 DB에 연결된 Connection 객체들을 미리 생성하여 pool에 저장한다</li>
<li>DB에 요청 시, pool에서 Connection 객체를 가져와 DB에 접근한다</li>
<li>처리가 끝나면 다시 </li>
</ol>
<img width="500" alt="스크린샷 2021-08-13 오후 9 44 45" src="https://user-images.githubusercontent.com/12459864/129360264-3d2fa805-766d-49b2-a239-1b62a70abf58.png">

<h3 id="Connection이-부족하면"><a href="#Connection이-부족하면" class="headerlink" title="Connection이 부족하면?"></a>Connection이 부족하면?</h3><ul>
<li>모든 요청이 DB에 접근하고 있고 남은 Connection이 없다면, 해당 클라이언트를 대기 상태로 전환시키고 Pool에 Connection이 반환되면 대기 상태에 있는 클라이언트에게 순차적으로 제공된다</li>
</ul>
<h3 id="왜-사용할까"><a href="#왜-사용할까" class="headerlink" title="왜 사용할까?"></a>왜 사용할까?</h3><ul>
<li>매 연결마다 Connection 객체를 생성하고 소멸시키는 비용을 줄일 수 있다</li>
<li>미리 생성된 Connection 객체를 사용하기 때문에, DB 접근 시간이 단축된다</li>
<li>DB에 접근하는 Connection 수를 제한하여, 메모리와 DB에 걸리는 부하를 조정할 수 있다</li>
</ul>
<h2 id="Commons-DBCP로-Connection-Pool-이해하기"><a href="#Commons-DBCP로-Connection-Pool-이해하기" class="headerlink" title="Commons DBCP로 Connection Pool 이해하기"></a>Commons DBCP로 Connection Pool 이해하기</h2><h3 id="Commons-DBCP-속성-설정"><a href="#Commons-DBCP-속성-설정" class="headerlink" title="Commons DBCP 속성 설정"></a>Commons DBCP 속성 설정</h3><ul>
<li><p>Commons DBCP의 속성은 BasicDataSource 클래스의 setter 메서드로 설정할 수 있다</p>
</li>
<li><p>Spring 프레임 워크를 사용한다면 다음과 같이 bean 설정으로 속성을 등록한다</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:driverClassName</span>=<span class="string">&quot;$&#123;db.driverClassName &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:url</span>=<span class="string">&quot;$&#123;db.url&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:username</span>=<span class="string">&quot;$&#123;db.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:password</span>=<span class="string">&quot;$&#123;db.password&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:maxActive</span>=<span class="string">&quot;$&#123;db.maxActive&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:maxIdle</span>=<span class="string">&quot;$&#123;db.maxIdle&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:maxWait</span>=<span class="string">&quot;$&#123;db.maxWait&#125;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="커넥션의-개수"><a href="#커넥션의-개수" class="headerlink" title="커넥션의 개수"></a>커넥션의 개수</h3><h4 id="커넥션-풀의-저장-구조"><a href="#커넥션-풀의-저장-구조" class="headerlink" title="커넥션 풀의 저장 구조"></a>커넥션 풀의 저장 구조</h4><ul>
<li>커넥션 생성은 Commons DBCP에서 이루어진다</li>
<li>Commons DBCP는 PoolableConnection 타입의 커넥션을 생성하고 생성한 커넥션에 ConnectionEventListener를 등록한다</li>
<li>ConnectionEventListener에는 애플리케이션이 사용한 커넥션을 풀로 반환하기 위해 JDBC 트라이버가 호출할 수 있는 콜백 메서드가 있다</li>
<li>생선된 커넥션은 commons-pool의 addObject() 메서드로 커넥션 풀에 추가된다</li>
<li>commons-pool은 내부적으로 현재 시간을 담고 있는 타임 스탬프와 추가된 커넥션의 레퍼런스를 한 쌍으로하는 ObjectTimestampPari라는 자료구조를생헝한다</li>
<li>이들을 LIFO(last in first out) 형태의 CursorableLinkedList로 관리한다</li>
</ul>
<img width="600" alt="스크린샷 2021-08-13 오후 9 58 31" src="https://user-images.githubusercontent.com/12459864/129361133-06879c87-e511-4d7a-b48a-ff34e992c27c.png">

<h4 id="커넥션-개수-관련-속성"><a href="#커넥션-개수-관련-속성" class="headerlink" title="커넥션 개수 관련 속성"></a>커넥션 개수 관련 속성</h4><table>
<thead>
<tr>
<th>속성 이름</th>
<th>설명</th>
</tr>
</thead>
<tbody><tr>
<td>initialSize</td>
<td>BasicDataSource 클래스 생성 후 최초로 getConnection() 메서드를 호출할 때 커넥션 풀에 채워 넣을 커넥션 수</td>
</tr>
<tr>
<td>maxActive</td>
<td>동시에 사용할 수 있는 최대 커넥션 개수 (기본값: 8)</td>
</tr>
<tr>
<td>maxIdle</td>
<td>커넥션 풀에 반납할 때 최대로 유지될 수 있는 커넥션 개수 (기본값: 8)</td>
</tr>
<tr>
<td>minIdle</td>
<td>최소한으로 유지할 커넥션 개수 (기본값: 0)</td>
</tr>
</tbody></table>
<ul>
<li><p>8개의 커넥션을 최대로 활용할 수 있고 4개는 사용중이고 4개는 대기 중인 상태</p>
  <img width="500" alt="스크린샷 2021-08-13 오후 11 06 15" src="https://user-images.githubusercontent.com/12459864/129369423-0d9c868f-4d87-479a-a079-30df962c06d1.png">
</li>
<li><p>커넥션 개수와 관련된 가장 중요한 성능 요소는 일반적을 커넥션의 최대 개수이다</p>
</li>
<li><p>maxActive 값은 DBMS의 설정과 애플리케이션 서버의 개수, Apache, Tomcat에서 동시에 처리할 수 있는 사용자 수 등을 고려해서 설정해야 한다.</p>
</li>
<li><p>DBMS가 수용할 수 잇는 커넥션 개수를 확인한 후에 어플리케이션 서버 인스턴스 1개가 사용하기에 적절한 개수를 설정한다</p>
</li>
<li><p>사용자가 몰려서 커넥션을 많이 사용할 때는 maxActive 값이 충분히 크지 않다면 병목 지점이 될 수 있다</p>
</li>
<li><p>반대로 사용자가 적어서 사용자가 적어서 상요 중인 커넥션이 많지 않은 시스템에서는 maxActive 값을 지나치게 작게 설정하지 않는 한 성능에 영향이 없다</p>
</li>
</ul>
<h3 id="커넥션을-얻기-전-대기-시간"><a href="#커넥션을-얻기-전-대기-시간" class="headerlink" title="커넥션을 얻기 전 대기 시간"></a>커넥션을 얻기 전 대기 시간</h3><ul>
<li>BasicDataSource 클래스의 maxWait 속성은 커넥션 풀 안의 커넥션이 고갈됐을 때 커넥션 반납을 대기하는 시간이며 기본값은 무한정이다</li>
<li>사용자가 갑자기 급증하거나 DBMS에 장애가 발생했을 때 장애를 더욱 크게 확산시킬 수 있어 주의해야 한다.</li>
<li>적절한 maxWait 값을 설정하려면 TPS(transaction per seconds)와 Tomcat에서 처리 가능한 스레드 개수 등을 이해해야 한다</li>
</ul>
<h4 id="TPS-transaction-per-seconds"><a href="#TPS-transaction-per-seconds" class="headerlink" title="TPS(transaction per seconds)"></a>TPS(transaction per seconds)</h4><ul>
<li>maxActive = 5과 maxIdle = 5, minIdle = 5로 설정한 상황을 가정한다</li>
<li>요청 하나당 쿼리 10개를 실행한다고 가정한다</li>
<li>각 쿼리의 평균 실행 시간은 50밀리초라고 하면 전체 10개 쿼리의 실행 시간은 500밀리초 이다.</li>
<li>요청에 대한 초종 응답 시간은 500밀리초라고 생각할 수 있다.</li>
</ul>
<img width="600" alt="스크린샷 2021-08-13 오후 11 36 50" src="https://user-images.githubusercontent.com/12459864/129373713-47b6a934-5508-4f9d-abca-0221f34ec548.png">

<ul>
<li>커넥션 풀에 이용 가능한 유휴 상태의 커넥션이 5개일 때는 동시에 5개의 요청을 500밀리초 동안 처리한다</li>
<li>따라서 1초 동안에는 10개의 요청을 처리할 수 있고 성능 지수는 10TPS라고 볼 수 있다</li>
</ul>
<img width="600" alt="스크린샷 2021-08-13 오후 11 39 35" src="https://user-images.githubusercontent.com/12459864/129374488-f3e9bbc8-6ac1-403f-aba2-4752c0bc8f31.png">

<h4 id="TPS와-커넥션-개수와의-관계"><a href="#TPS와-커넥션-개수와의-관계" class="headerlink" title="TPS와 커넥션 개수와의 관계"></a>TPS와 커넥션 개수와의 관계</h4><ul>
<li>처리할 요청 수가 증가해도 커넥션 풀의 커넥션 개수가 5개이면 10TPS 이상의 성능을 낼 수 없다</li>
<li>1번부터 5번까지 요청이 실행되는 동안은 커넥션 풀에 여분의 커넥션이 없다</li>
<li>6번부터 10번까지 요청은 대기(wait)상태가 되 여분의 커넥션이 생길 때까지 maxWait 값만큼 기다린다</li>
</ul>
<img width="600" alt="스크린샷 2021-08-13 오후 11 39 41" src="https://user-images.githubusercontent.com/12459864/129374493-f499dc43-efa9-4fef-98fb-ccf4e9693294.png">

<ul>
<li>이를 해결하는 가장 수운 방법은 maxActive 값을 높여서 커넥션 풀의 개수를 늘리는 것이다</li>
</ul>
<img width="600" alt="스크린샷 2021-08-13 오후 11 42 44" src="https://user-images.githubusercontent.com/12459864/129374496-1dea2379-57b1-450d-a4df-90595822e7dd.png">

<ul>
<li>커넥션의 개수를 5에서 10으로 늘리면 전체적인 성능도 10TPS로 증가한다</li>
<li>하지만 일반적을 DBMS의 리소스는 다른 서비스와 공유해 사용하는 경우가 많기 때문에 무조건 커넥션 개수를 크게 설정할 수 없다</li>
<li>따라서 예상 접속자 수와 서비스의 실제 부하를 측정해 최적의 값을 설정하는 것이 중요하다</li>
<li>대기 시간 (wait) 값 조절이 커넥션의 개수를 무한히 늘리지 않고 최적의 시스템을 환겨을 구축하는데 중요한 역할을 한다</li>
<li>maxWait 값을 어떻게 설정했는지가 일시적인 과부하 상태에서 드러나는 시스템의 전체적인 견고함을 결정짓는다</li>
</ul>
<img width="600" alt="스크린샷 2021-08-13 오후 11 47 36" src="https://user-images.githubusercontent.com/12459864/129375608-11845037-adc0-40e0-8324-6f999ed25818.png">

<ul>
<li>적당한 maxWait 값은 Commons DBCP 외에 Tomcat의 동작 방식도 고려해야 한다</li>
<li>Tomcat은 스레드 기반으로 동작해 사용자의 요청을 처리한다</li>
<li>Tomcateh 내부에 스레드 풀을 가지고 잇어서 사용자의 요청이 들어올 때마다 스레드 풀에서 하나씩 스레드를 꺼내 요청을 처리한다</li>
<li>1 ~ 5번의 요청이 처리되기 전에 또 다른 요청이 들어온다</li>
<li>즉 동시에 6개의 요청이 들어왔을 때 6번 요청은 여분의 커넥션이 없으므로 maxWait 값 만큼 기다린다 (Tomcat의 스레드가 기다리는 주체이다)</li>
</ul>
<h4 id="적절한-maxWait-값은"><a href="#적절한-maxWait-값은" class="headerlink" title="적절한 maxWait 값은?"></a>적절한 maxWait 값은?</h4><ul>
<li>위의 그림에서 maxWait 속성에 설정한 시간이 10,000 밀리초이면 처리량을 넘어서는 요청의 스레드는 10초 동안 대기 상태에 있게 된다</li>
<li>그리고 사용자의 요청이 계속 증가하면 결국 Tomcat 스레드 풀의 모든 스레드가 소진돼 Tomcat은 아래와 같은 오류를 출력하며 응답을 멈출 것이다  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">심각: All threads (512) are currently busy, waiting. Increase maxThreads (512) or check the servlet status</span><br></pre></td></tr></table></figure></li>
<li>10초 동안의 대기 상태가 해제되고 커넥션을 획득해 사용자의 요청을 열심히 처리하고 응답을 보내도 그 응답을 받을 사용자는 이미 떠나고 난 뒤인 경우도 있다</li>
<li>이럴 경우 사용자가 인내할 수 있는 시간을 넘어서는 maxWait 값은 아무런 의미가 없다</li>
<li>반대의 경우에는 커넥션 풀에 여분이 없을 때마다 오류가 반환된다</li>
<li>maxWait 값도 사용자의 대기 가능한 시간 같은, 어플리케이션의 특성 및 자원의 상황을 고려해야한다</li>
<li>만약 갑작스럽게 사용자가 증가해 maxWait 값 안에 커넥션을 얻지 못하는 빈도가 늘어난다면 maxWait을 줄여서 스레드가 한도에 도달하지 않도록 한다</li>
<li>전체 시스템의 장애는 피하고 ‘간헐적 오류’가 발생하는 정도로 장애의 영향을 줄인다</li>
<li>이런 상황이 자주 있다면 Commons DBCP의 maxActive 값과 Tomcat의 maxThread 값을 동시에 늘이는 것을 고려한다 </li>
<li>그러나 시스템 자원의 한도를 넘어선다면 시스템을 확충해야한다</li>
</ul>
<h3 id="커넥션의-검사와-정리"><a href="#커넥션의-검사와-정리" class="headerlink" title="커넥션의 검사와 정리"></a>커넥션의 검사와 정리</h3><ul>
<li>유효성 검사 쿼리 (validation query)와 Evictor 스레드 관련 설정으로도 애플리케이션의 안정성을 높일 수 있다</li>
</ul>
<h4 id="유효성-검사쿼리의-설정"><a href="#유효성-검사쿼리의-설정" class="headerlink" title="유효성 검사쿼리의 설정"></a>유효성 검사쿼리의 설정</h4><ul>
<li>JDBC 커넥션의 유효성에 대한 validationQuery 옵션<ul>
<li>testOnBorrow: 커넥션 풀에서 커넥션을 얻어올 때 테스트 실행(기본값: true)</li>
<li>testOnReturn: 커넥션 풀로 커넥션을 반환할 때 테스트 실행(기본값: false)</li>
<li>testWhileIdle: Evictor 스레드가 실행될 때 (timeBetwwenEvictionRunMills &gt; 0) 커넥션 풀 안에 있는 유휴 상태의 커넥션을 대상으로 테스트 실행 (기본값: false)</li>
</ul>
</li>
<li>검증에 지나치게 자원을 소모하지 않게 testOnBorrow와 testOnReturn 옵션을 false로 설정한다</li>
<li>오랫동안 대기상태였던 커넥션이 끊어지는 현상을 막기위해 testWhileIdle 옵션은 true로 설정한다</li>
<li>부적절한 상태의 커넥션이 반납되었을 때 testWhileIdle = true이면 커넥션 풀에서 오류가 발생하는 커넥션을 제외할 수 있다</li>
</ul>
<h3 id="Evictor-스레드와-관련된-속성"><a href="#Evictor-스레드와-관련된-속성" class="headerlink" title="Evictor 스레드와 관련된 속성"></a>Evictor 스레드와 관련된 속성</h3><ul>
<li><p>Evictor 스레드는 Commons DBCP 내부에서 커넥션의 자원을 정리하는 구성요소이며 별도의 스레드로 실행된다</p>
</li>
<li><p>관련 속성</p>
<ul>
<li>timeBetweenEvictionRunsMills: Evictor 스레드가 동작하는 간격, 기본값은 -1이며 Evictor 스레드의 실행이 비활성화되어있다</li>
<li>numTestsPerEvictionRun: Evictor 스레드 동작 시 한 번에 검사할 커넥션 수</li>
<li>minEvictableIdleTimeMillis: 스레드 동작 시 커넥션의 유휴 시간을 확인해 설정 값 이상일 경우 커넥션을 제거한다 (기본값: 30분)</li>
</ul>
</li>
<li><p>역할</p>
<ol>
<li><p>커넥션 풀 내의 유휴 상태의 커넥션 중에서 오랫동안 사용되지 않은 커넥션을 추출해 제거한다</p>
<ul>
<li>Evictor 스레드 실행 시 설정된 numTestsPerEvictionRun 속서값만큼 CursorableLinkedList의 ObjectTimestampPar을 확인한다</li>
<li>ObjectTimestampPair의 타임 스탬프 값과 현재 시간의 타임 스탬프 값의 차이가 minEvictableIdleTimeMillis 속성을 초과하면 해당 커넥션을 제거한다</li>
<li>커넥션 숫자를 적극적으로 줄여야한다면 사용하지 않기</li>
</ul>
</li>
<li><p>커넥션에 대해서 추가로 유효성 검사를 수행해 문제가 있을 경우 해당 커넥션을 제거한다</p>
<ul>
<li>testWhileIdle = true 일때만 이 동작을 수행한다</li>
<li>첫 번째 작업 시 minEvictableIdleTimeMillis 속성값을 초과하지 않은 커넥션에 대해서 추가로 유효성 검사를 수행하는 것이다.</li>
</ul>
</li>
<li><p>앞의 두 작업 이후 남아있는 커넥션의 개수가 minIdle 속성값보다 작으면 minIdle 속성값 만큼 커넥션을 생성해 유지한다</p>
<p><code>testWhileIdle=true &amp;&amp; timeBetweenEvictionRunMillis &gt; 0이면 위의 3가지 역할을 다 수행하고, </code></p>
<p><code>testWhileIdle=false &amp;&amp; timeBetweenEvictionRunMillis &gt; 0이면 두 번째 동작은 수행하지 않는다.</code></p>
</li>
</ol>
</li>
<li><p>주의점</p>
<ul>
<li>Evictor 스레드는 동작 시에 커넥션 풀에 잠금(lock)을 걸고 동작하기 때문에 너무 자주 실행하면 서비스 실행에 부담을 줄 수 있다</li>
<li>numTestsPerEvictionRun 값을 너무 크게 설정하면 Evictor 스레드가 검사해야하는 커넥션 수가 많아져 잠금 상태에 있는 시간이 길어지므로 실행에 부담이 된다.</li>
</ul>
</li>
<li><p>유용한 방안</p>
<ul>
<li>IDC(internet data center) 정책에 따라서는 서버 간의 소켓 연결 후 정해진 시간 이상 아무런 패킷도 주고받지 않으면 연결을 종료한다</li>
<li>timeBetweenEvictionRunsMills 속성으로 의도하지 않게 연결이 끊어지는 것을 방어할 수 있다.</li>
<li>ex) 30분 동안 통신이 없을 때 연결이 끊어지는 정책으로 네트워크를 운영한다면, BasicDataSource가 풀링(pooling)하는 커넥션의 수가 30개라고 가정할 때<ul>
<li>30분 안에 모든 커넥션에 유효성 검사 쿼리를 한 번씩은 실행하는 것이 바람직하다.</li>
<li>Evictor 스레드가 5분에 한 번씩 실행되도록 설정했을 때 30분 동안 Evictor 스레드 실행 횟수는 6번이므로 매번 5개의 커넥션을 검사해야 전체 커넥션을 테스트할 수 있다.</li>
<li>30분 안에 5분마다 Evctor 스레드가 실행되면 6번 실행되지만 오차를 감안해 5번으로 가정하면 이때 설정해야 할 numTestsPerEvictionRun 값은 다음과 같이 구할 수 있다</li>
<li><code>6 * numTestsPerEvictionRun &gt; 30개</code></li>
<li>따라서 numTestsPerEvictionRun 속성값은 최소 6 이상이어야 한다. 일반적인 공식으로 정리하면 다음과 같다</li>
<li><code>(&#39;IDC 정책에서 허용하는 최대 유휴 커넥션 유지 시간&#39; / timeBetweenEvictionRunsMillis 속성값) * numTestsPerEvictionRun 속성값) &gt; 전체 커넥션 개수</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://d2.naver.com/helloworld/5102792">https://d2.naver.com/helloworld/5102792</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/WeareSoft/tech-interview/blob/master/contents/db.md">https://github.com/WeareSoft/tech-interview/blob/master/contents/db.md</a></li>
</ul>
<h2 id="읽어보면-좋은-것들"><a href="#읽어보면-좋은-것들" class="headerlink" title="읽어보면 좋은 것들"></a>읽어보면 좋은 것들</h2><ul>
<li>1부 : <a target="_blank" rel="noopener" href="https://techblog.woowahan.com/2664/">https://techblog.woowahan.com/2664/</a></li>
<li>2부 : <a target="_blank" rel="noopener" href="https://techblog.woowahan.com/2663/">https://techblog.woowahan.com/2663/</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/08/10/Network-4-Transport-Layer/"
                    data-tooltip="Network-4-Transport Layer"
                    aria-label="NEXT: Network-4-Transport Layer"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 Yechan Kim. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/08/10/Network-4-Transport-Layer/"
                    data-tooltip="Network-4-Transport Layer"
                    aria-label="NEXT: Network-4-Transport Layer"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">Yechan Kim</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://kimyechan.github.io/2021/08/12/DATABASE-Connection-Pool/';
              
            this.page.identifier = '2021/08/12/DATABASE-Connection-Pool/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'xhandev';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
